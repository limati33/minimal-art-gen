# Минималистичный арт-генератор (фото + видео)

Набор скриптов для стилизации изображений/видео в различные художественные эффекты:
постеризация, комикс, акварель, TV-box, граффити/LED, векторизация, и т. д.
Проект ориентирован на локальную обработку (OpenCV + sklearn + FFmpeg для финального сжатия).

> ВАЖНО: интерактивные "поднастройки" внутри эффектов **отменены**. Эффекты используют только значения по умолчанию или параметры, прокинутые из кода. Если вам нужно изменить поведение эффекта — редактируйте соответствующий модуль в `processor/effects/`.

---

## Установка

1. Рекомендуется создать виртуальное окружение:
```bash
python -m venv .venv
source .venv/bin/activate    # macOS / Linux
.venv\Scripts\activate       # Windows
````

2. Установить Python-зависимости:

```bash
pip install -r requirements.txt
```

3. Установите FFmpeg (не через pip). На Windows — скачайте сборку и добавьте `ffmpeg.exe` в PATH. На macOS — `brew install ffmpeg`. На Linux — `sudo apt install ffmpeg` или аналог.

---

## Быстрый старт

* Обработка одного изображения:

```bash
python main.py /путь/к/изображению.png
```

* Обработка нескольких файлов:

```bash
python main.py file1.jpg file2.png movie.mp4
```

* CLI спросит параметры (количество цветов, масштаб, эффект). Для видео используются только первые значения (чтобы не генерировать много видеофайлов).

---

## Поддерживаемые эффекты

Эффекты находятся в `processor/effects/`. Номера и имена эффектов отображаются в UI (файл `utils/effects_table.py`).

> **Поднастройки внутри эффектов отключены**: эффекты не будут спрашивать параметры при первом вызове. Если нужно изменить поведение — отредактируйте параметры внутри соответствующего файла эффекта (функция `apply_*`).

---

## Видео: сохранение качества и кодеки

* Для финального сжатия используется FFmpeg (`libx264`) с `-crf 18 -preset fast` — почти невидимая компрессия при разумном размере.
* Текущая логика: кадры пишутся во временный файл (AVI / MJPG), затем FFmpeg кодирует итоговый MP4.
* Если нужна более высокая/меньшая компрессия — замените `-crf` (меньше → лучше качество и больше размер; 18–23 обычно хороший диапазон).

### Битрейт

* CRF лучше, чем фиксированный битрейт, для сохранения качества. При необходимости можно добавить `-b:v Xk` в FFmpeg команду.

---

## Отладка — частые ошибки и решения

* `FFmpeg не найден` — убедитесь, что `ffmpeg` установлен и доступен из командной строки (PATH).
* `NameError: name 'np' is not defined` — в модуле эффекта забыли `import numpy as np`. Проверьте импорт в начале файла.
* OpenCV ошибки как `pointPolygonTest` — ошибки типов (например, передача массивов неправильной формы). Проверяйте, что координаты/типы соответствуют документации OpenCV (int32/float32 и т. д.).
* Если эффект ведёт себя непредсказуемо для видео (мерцание палитры) — убедитесь, что KMeans обучается один раз (в `process_video`) и используется для всех кадров.
* Если обработка видео идёт медленно — уменьшите разрешение (`scale`), уменьшите `n_colors` или упростите эффект.

---

## Советы по тестированию эффектов

Рекомендуется тестировать не на одном изображении, а на наборе из различных сцен:

1. Пейзаж (градиенты)
2. Портрет (кожа, тени)
3. Иллюстрация/аниме (плоские цвета и контуры)
4. Город/много деталей (мелкие объекты)
5. Радуга/градиент (покрытие всех hue)
6. Ч/б (проверка Limbo/рентген-эффектов)
7. Пересвет/недоэкспозиция (тест на устойчивость)

---

## Примеры команд и сценариев

* Обычная обработка с заданными параметрами (через CLI):

  1. Запустите `python main.py`
  2. Выберите файл(ы)
  3. Введите `n_colors`, `scale`, `blur` и `mode` как запрошено

* Автоматическая пакетная обработка (скрипт):

  * Можно написать обёртку, которая вызывает `process_video` или `process_single` с нужным набором параметров программно (рекомендуется для массовой обработки).

---

## Вклад и развитие

* Если встроенные эффекты требуют тонких настроек — правьте файлы в `processor/effects/`.
* Для сохранения настроек между запусками можно добавить файл конфигурации (опционально).


# requirements.txt
```

numpy>=1.23
opencv-python>=4.6.0
scikit-learn>=1.1
scikit-image>=0.19
Pillow>=9.0
psutil>=5.9
colorama>=0.4
tqdm>=4.64

```
