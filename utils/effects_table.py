import textwrap
from .logging_utils import BOLD, BLUE, MAGENTA, CYAN, YELLOW, GREEN, RED, RESET

def show_effects_table():
    effects = [
        (1, "Постеризация", "Чистое упрощение цветов, без фильтров.", "Быстро", "Используй малое число цветов для графичных результатов"),
        (2, "Плавные пятна", "Мягкие переходы, глянец.", "Средне", "Подходит для портретов — увеличь bilateral для более плавного блеска"),
        (3, "Комикс", "Контуры + сглаженные пятна — рисунок тушью.", "Средне", "Уменьши резкость контуров, если слишком агрессивно"),
        (4, "Чернила", "Рисунок тушью: мягкая заливка + жирные линии, эффект наброска.", "Средне", "Попробуй менять силу Canny — линии станут тоньше или выразительнее"),
        (5, "Сетка", "Половинная тонировка/рубрикация — ретро-штриховка.", "Очень быстро", "Шаг сетки влияет на «тон»"),
        (6, "Пыль", "Мягкий шум + рассеянный свет в ярких зонах.", "Быстро", "Для эффекта — увеличь уровень шума и лёгкий blur"),
        (7, "Мел", "Рисование мелом: мягкие, немного сухие границы.", "Быстро", "Поиграй с detail / контрастом для «пыльного» мелка"),
        (8, "ASCII-Арт", "Только символы! Цветной + ЧБ версия.", "Очень быстро", "100% ASCII, без фона. Сохраняет ЧБ отдельно"),
        (9, "Пластик", "Глянцевый, игрушечный, яркие блики.", "Средне", "Добавь specular highlight mask для усиления блеска"),
        (10, "Ретро LCD", "Старый ЖК-экран: крупные пиксели, полосы подсветки, постеризация.", "Быстро", "Понизь масштаб — появятся «квадраты» как на ранних портативных приставках"),
        (11, "Векторизация", "Минималистичный арт из крупных цветных пятен.", "Медленно", "Количество цветов (K) задаёт уровень упрощения — меньше = чище."),
        (12, "Свеча", "Тёплое боковое освещение, золотистые тени.", "Очень быстро", "Подойдёт для сцен с тёплым настроением"),
        (13, "Голограмма", "Радужные переливы, как на CD-диске.", "Средне", "Использует шум, HSV-сдвиг и колормэп для блестящего эффекта"),
        (14, "Акварель", "Мягкие растекающиеся переходы, как кисть и вода.", "Быстро", "Убираем резкие контуры, ставим сильный edge-preserve + blur"),
        (15, "Технический", "Чертёж: белые линии на синем фоне (blueprint).", "Быстро", "Линии — белые, фон — синий; инвертируем каналы правильно"),
        (16, "Карта", "Топографическая палитра — уровни как карта высот.", "Очень быстро", "Подходит для пейзажей/спутника"),
        (17, "Мозаика", "Набор случайных фигур в сетке.", "Медленно", "Чем больше клеток — тем плотнее мозаика"),
        (18, "Сон", "Плывущая, слегка искажённая структура.", "Средне", "Искажения случайны — будут разные каждый раз"),
        (19, "Пиксель-Арт", "Чистая пикселизация (ретро).", "Очень быстро", "scale_factor ~0.05..0.2"),
        (20, "Огненный", "Тёплое свеча/пламя — мягкий glow в тёплых тонах.", "Средне", "Glow делается по яркостной маске, не просто контраст"),
        (21, "Рентген-контур", "Эффект как рентген-снимок: тонкие линии, масштабированные детали, монохром с акцентом цветом.", "Медленно", "Используй инверсию яркости и выделение тонких структур; цветной акцент может подчеркнуть контуры"),
        (22, "Graph", "Графический эффект: контуры + полиномиальная аппроксимация (y = P(x)), монохром с цветными акцентами.", "Медленно", "Используй инверсию яркости, CLAHE и multi-scale детекцию краёв; экспортирует PNG и TXT с уравнениями"),
        (23, "Vice City", "Неоновый ретро-вейв 80-х с VHS-зерном.", "Быстро", "Используй агрессивный Glow и высокий контраст сине-пурпурных оттенков."),
        (24, "TV Box", "Эффект кинескопа: Виньетка, полосы развертки и Рыбий глаз.", "Очень медленно", "Имитирует просмотр через старый ЭЛТ-монитор. Искажение Fish-eye может быть сильным."),
        (25, "Витраж", "Цветные стеклянные ячейки со свинцовыми границами.", "Медленно", "Имитирует классический узор витражного стекла."),
        (26, "Плёнка", "Цветные стеклянные ячейки со свинцовыми границами.", "Медленно", "Имитирует классический узор витражного стекла."),
        (27, "Принтер", "Цветные стеклянные ячейки со свинцовыми границами.", "Медленно", "Имитирует классический узор витражного стекла."),
    ]
    w_num, w_name, w_desc, w_speed = 4, 20, 45, 18
    wrap_desc = 45
    wrap_hint = 40

    print(f"\n{CYAN}{'='*110}{RESET}")
    print(f"{BOLD}{BLUE}СПИСОК ДОСТУПНЫХ ЭФФЕКТОВ (с подсказками){RESET}")
    print(f"{CYAN}{'-'*110}{RESET}")

    # Формируем заголовок — сначала выравниваем чистый текст, потом красим
    hdr_num = f"{'№':<{w_num}}"
    hdr_name = f"{'Название':<{w_name}}"
    hdr_desc = f"{'Описание':<{w_desc}}"
    hdr_speed = f"{'Скорость':<{w_speed}}"
    header = f"{BOLD}{MAGENTA}{hdr_num}{RESET}{CYAN}{hdr_name}{RESET}{YELLOW}{hdr_desc}{RESET}{GREEN}{hdr_speed}{RESET}Подсказка"
    print(header)
    print(f"{CYAN}{'-'*110}{RESET}")

    for n, name, desc, speed, hint in effects:
        desc_lines = textwrap.wrap(desc, wrap_desc)
        hint_lines = textwrap.wrap(hint, wrap_hint)
        max_lines = max(len(desc_lines), len(hint_lines))

        # Сначала выравниваем ПЛЕЙН-тексты, затем оборачиваем цветом (чтобы ANSI не ломали ширину)
        name_padded = f"{name:<{w_name}}"
        num_padded = f"{n:<{w_num}}"
        speed_padded = f"{speed:<{w_speed}}"

        name_col = f"{CYAN}{name_padded}{RESET}"
        num_col = f"{BOLD}{MAGENTA}{num_padded}{RESET}"
        speed_col = f"{GREEN}{speed_padded}{RESET}"

        desc_color = YELLOW

        for i in range(max_lines):
            # номер и имя только на первой строке, иначе — пробелы соответствующей ширины
            num_str = num_col if i == 0 else " " * w_num
            name_str = name_col if i == 0 else " " * w_name

            if i < len(desc_lines):
                desc_plain = f"{desc_lines[i]:<{w_desc}}"
                desc_str = f"{desc_color}{desc_plain}{RESET}"
            else:
                desc_str = " " * w_desc

            speed_str = speed_col if i == 0 else " " * w_speed
            hint_str = hint_lines[i] if i < len(hint_lines) else ""

            print(f"{num_str}{name_str}{desc_str}{speed_str}{hint_str}")

    print(f"{CYAN}{'='*110}{RESET}\n")